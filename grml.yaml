version: 1
project: wahtari-open-model-zoo-demos

env:
    GOPRIVATE:  git.wahtari.m
    DOCKERHOST: docker.wahtari.m
    DOCKERREPO: nlab
    DOCKERVER:  v0.0.28
    BINDIR:     ${ROOT}/bin
    BUILDDIR:   ${ROOT}/build
    NAPPDIR:    ${ROOT}/napps

commands:
    clean:
        help: clean the build files
        exec: |
            rm -rf "${BINDIR}" "${BUILDDIR}"

    build:
        help: build targets.
        commands:
            builder:
                help: build the builder docker image.
                exec: |
                    # Build the docker container.
                    docker build \
                        --tag wahtari/openvino_openmodelzoo_demos \
                        --build-arg dockerversion=${DOCKERVER} \
                        "${ROOT}/demos"
            classification_benchmark:
                help: classification benchmark
                exec: |
                    mkdir -p ${BINDIR} ${BUILDDIR}

                    docker run -it --rm \
                        -e USER="1000:1000" \
                        -v "${ROOT}:/work:ro" \
                        -v "${BUILDDIR}:/home/builder/omz_demos_build" \
                        -v "${BINDIR}:/home/builder/omz_demos_build/intel64/Release" \
                        wahtari/openvino_openmodelzoo_demos \
                        demos/build_demos.sh --target=classification_benchmark_demo
                commands:
                    napp:
                        help: build the nApp container
                        deps:
                            - build.demo.classification_benchmark
                        exec: |
                            docker build \
                                --tag wahtari/omz-demos-class-bench \
                                --file "${ROOT}/demos/classification_benchmark_demo/cpp/Dockerfile" \
                                "${BINDIR}"

                            # Save the docker container as tar archive.
                            mkdir -p ${NAPPDIR}
                            docker save \
                                --output "${NAPPDIR}/wahtari-omz-demos-class-bench.docker.tar" \
                                wahtari/omz-demos-class-bench
            human_pose_estimation_demo:
                help: human pose estimation demo
                exec: |
                    mkdir -p ${BINDIR} ${BUILDDIR}

                    docker run -it --rm \
                        -e USER="1000:1000" \
                        -v "${ROOT}:/work:ro" \
                        -v "${BUILDDIR}:/home/builder/omz_demos_build" \
                        -v "${BINDIR}:/home/builder/omz_demos_build/intel64/Release" \
                        wahtari/openvino_openmodelzoo_demos \
                        demos/build_demos.sh --target=human_pose_estimation_demo